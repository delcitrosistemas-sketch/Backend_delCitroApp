generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_PRUEBA_URL")
}

model USUARIOS {
    id              Int       @id @default(autoincrement())
    usuario         String @unique
    rol             ROLES_GENERALES
    hash            String
    hashedRt        String?
    avatar          String?
    createdAt       DateTime       @default(now())
    updatedAt       DateTime       @default(now())

    archivosSGC     DOCUMENTOS_SGC[]
    permisos        USUARIOS_PERMISOS[]

    @@map("USUARIOS")

}

model USUARIOS_PERMISOS {
    id                  Int                 @id @default(autoincrement())
    usuario_id          Int
    area_id             Int
    rol_area            ROLES_AREA
    activo              Boolean             @default(true)
    createdAt           DateTime            @default(now())
    updatedAt           DateTime            @default(now())

    usuario             USUARIOS            @relation(fields: [usuario_id], references: [id], onDelete: Cascade)
    area                AREAS               @relation(fields: [area_id], references: [id])

    @@unique([usuario_id, area_id])
    @@map("USUARIOS_PERMISOS")
}

model CLIENTES {
    id                      Int             @id @default(autoincrement())
    primer_nombre           String
    segundo_nombre          String
    apellido_paterno        String
    apellido_materno        String
    correo                  String
    telefono                String 
    direccion               String
    empresa                 String
    createdAt               DateTime        @default(now())
    updatedAt               DateTime        @default(now())

    reg_embarques           REGISTRO_EMBARQUES[]
    reg_salida_prod         REGISTRO_SALIDA_PRODUCTO_TERMINADO[]
    reg_fruta_pros          REGISTRO_SALIDA_FRUTA_PROCESADA[]

    @@map("CLIENTES")
}

model PROVEEDORES {
    id                      Int             @id @default(autoincrement())
    nombre                  String?
    empresa                 String
    direccion               String?
    estado                  String
    codigoPostal            String?
    pais                    String          @default("México")
    telefono                String
    email                   String?
    createdAt               DateTime        @default(now())
    updatedAt               DateTime        @default(now())

    reg_entrada_fruta       REGISTRO_DESCARGA_FRUTA_PARA_PROCESO[]

    @@map("PROVEEDORES")
}

model EMPLEADOS {
    id                      Int                         @id @default(autoincrement())
    num_emp                 Int                         @default(autoincrement())
    primer_nombre           String
    segundo_nombre          String?
    apellido_paterno        String?
    apellido_materno        String?
    correo                  String?
    telefono                String
    direccion               String?
    edad                    Int?
    genero                  GENEROS
    status                  String              @default("Activo")
    area_id                 Int
    departamento_id         Int
    puesto_id               Int
    detalles_id             Int
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    area_asignada           AREAS               @relation(fields: [area_id], references: [id])
    departamento            DEPARTAMENTOS       @relation(fields: [departamento_id], references: [id])
    puesto                  PUESTOS             @relation(fields: [puesto_id], references: [id])
    detalles                DETALLES_EMPLEADO   @relation(fields: [detalles_id], references: [id])

    @@map("EMPLEADOS")
}

model DETALLES_EMPLEADO {
    id                      Int                         @id @default(autoincrement())
    incidencia_id           Int
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    empleado                EMPLEADOS[]

    incidencias             INCIDENCIAS          @relation(fields: [incidencia_id], references: [id])

    @@map("DETALLES_EMPLEADO")
}

model INCIDENCIAS {
    id                      Int                         @id @default(autoincrement())
    tipo                    String
    fecha                   DateTime

    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    detalles                DETALLES_EMPLEADO[]
    
    @@map("INCIDENCIAS")
}

model ROLES {
    id              Int             @id @default(autoincrement())
    rol             String
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now())
    
    @@map("ROLES")
}

model AREAS {
    id              Int             @id @default(autoincrement())
    nombre          String
    codigo          String?          @unique
    activo          Boolean?         @default(true)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now()) 

    empleado        EMPLEADOS[]
    departamentos   DEPARTAMENTOS[]
    chofer          CHOFER[]
    permisos        USUARIOS_PERMISOS[]
    modulos         MODULOS_AREA[] 

    @@map("AREAS")

}

model MODULOS_AREA {
    id              Int             @id @default(autoincrement())
    area_id         Int
    nombre          String          // Ej: "Muestreos", "Descarga", "Finanzas"
    codigo          String          // Ej: "muestreos", "descarga", "finanzas"
    url             String?         // URL del módulo
    icono           String?         // Nombre del icono
    orden           Int             @default(0)
    activo          Boolean         @default(true)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now())

    area            AREAS           @relation(fields: [area_id], references: [id])
    permisos        PERMISOS_MODULO[]

    @@unique([area_id, codigo])
    @@map("MODULOS_AREA")
}

model PERMISOS_MODULO {
    id              Int             @id @default(autoincrement())
    modulo_id       Int
    rol_area        ROLES_AREA
    puede_crear     Boolean         @default(false)
    puede_leer      Boolean         @default(false)
    puede_actualizar Boolean        @default(false)
    puede_eliminar  Boolean         @default(false)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now())

    modulo          MODULOS_AREA    @relation(fields: [modulo_id], references: [id], onDelete: Cascade)

    @@unique([modulo_id, rol_area])
    @@map("PERMISOS_MODULO")
}

model DEPARTAMENTOS {
    id              Int             @id @default(autoincrement())
    nombre          String
    area_id         Int
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now())
    
    area            AREAS           @relation(fields: [area_id], references: [id])
    empleado        EMPLEADOS[]
    chofer          CHOFER[]

    @@map("DEPARTAMENTOS")

}

model PUESTOS {
    id              Int             @id @default(autoincrement())
    nombre          String
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @default(now()) 

    empleado        EMPLEADOS[]
    chofer          CHOFER[]

    @@map("PUESTOS")

}

enum ROLES_AREA {
    ADMINISTRADOR_AREA  // Administrador completo del área
    SUPERVISOR_AREA     // Supervisor con permisos limitados
    OPERADOR           // Solo consulta y operaciones básicas
    VISUALIZADOR       // Solo consulta
}

model REGISTRO_DESCARGA_FRUTA_PARA_PROCESO {
    id                              Int             @id @default(autoincrement())
    folio                           String             @unique
    fecha                           DateTime
    boleta                          Int
    placas_transporte               String
    chofer                          String?
    variedad                        String
    destino                         String
    inicio_descarga                 DateTime?
    fin_descarga                    DateTime?
    cant_progra_desca               Float?
    cant_real_desca                 Float?
    proveedor_id                    Int
    detalles_id                     Int?
    createdAt                       DateTime        @default(now())
    updatedAt                       DateTime        @default(now()) 

    proveedor       PROVEEDORES     @relation(fields: [proveedor_id], references: [id])
    detalles        DETALLES_REGISTRO_DESCARGA_FRUTA_PARA_PROCESO?     @relation(fields: [detalles_id], references: [id])

    @@map("REGISTRO_DESCARGA_FRUTA_PARA_PROCESO")

}

model DETALLES_REGISTRO_DESCARGA_FRUTA_PARA_PROCESO {
    id                              Int             @id @default(autoincrement())
    bins                            Int?
    jaula                           String?
    estado                          String?
    municipio                       String?
    huerta                          String? 
    observaciones                   String?
    muestra_id                      Int?   
    createdAt                       DateTime        @default(now())
    updatedAt                       DateTime        @default(now()) 

    muestreo                MUESTREOS? @relation(fields: [muestra_id], references: [id])
    registro_fruta          REGISTRO_DESCARGA_FRUTA_PARA_PROCESO[]   

    @@map("DETALLES_REGISTRO_DESCARGA_FRUTA_PARA_PROCESO")
}

model REGISTRO_ACEITE_ESCENCIAL {
    id                  Int             @id @default(autoincrement())
    proceso_id          Int             
    fecha_proceso       DateTime
    lote                String
    ton_procesadas      Float   
    fecha_vaciado       DateTime
    silo                Float // litros
    inv_inicial         Float // kg
    agregado            Float // kg
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @default(now()) 

    @@map("REGISTRO_ACEITE_ESCENCIAL")

}

model REGISTRO_EMBARQUES {
    id                  Int             @id @default(autoincrement())
    proceso_id          Int
    tipo                String
    cliente_id            Int
    fecha_salida        DateTime
    lote                String
    embalaje            String?
    cantidad            Float
    boleta              Int // numero de boleta
    peso_neto           Float?
    litros              Float?
    galones             Float?
    libras_solido       Float?
    brix                String?
    acidez              Float?
    relacion            String?
    observaciones       String?
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @default(now()) 

    empresa             CLIENTES        @relation(fields: [cliente_id], references: [id])

    @@map("REGISTRO_EMBARQUES")

}

model REGISTRO_SALIDA_PRODUCTO_TERMINADO {
    id                  Int             @id @default(autoincrement())
    proceso_id          Int
    tipo                String
    cliente_id             Int
    fecha_envasado      DateTime
    lote                String
    embalaje            String
    cantidad            Float // 
    fila_almacen        Int
    peso_neto           Float
    litros              Float
    galones             Float?
    libras_solido       Float?
    brix                Float?
    acidez              Float?
    relacion            Float?
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @default(now()) 

    empresa             CLIENTES        @relation(fields: [cliente_id], references: [id])

    @@map("REGISTRO_SALIDA_PRODUCTO_TERMINADO")

}

model REGISTRO_SALIDA_FRUTA_PROCESADA {
    id                  Int             @id @default(autoincrement())
    doc_nro             String
    fecha               DateTime
    placa               String
    cliente_id            Int
    producto            String
    peso_ingreso        Float
    peso_salida         Float
    peso_neto           Float
    chofer              String
    transportista       String
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @default(now()) 

    empresa             CLIENTES        @relation(fields: [cliente_id], references: [id])

    @@map("REGISTRO_SALIDA_FRUTA_PROCESADA")

}

model CHOFER {
    id                      Int                 @id @default(autoincrement())
    primer_nombre           String
    segundo_nombre          String?
    apellido_paterno        String?
    apellido_materno        String?
    telefono                String
    direccion               String?
    edad                    Int?
    genero                  GENEROS
    area_id                 Int
    departamento_id         Int
    puesto_id               Int // Chofer
    vehiculo_id             Int // Transporte
    placa                   String
    empresa                 String?
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    area                    AREAS               @relation(fields: [area_id], references: [id])
    departamento            DEPARTAMENTOS       @relation(fields: [departamento_id], references: [id])
    puesto                  PUESTOS             @relation(fields: [puesto_id], references: [id])
    vehiculo                TRANSPORTE          @relation(fields: [vehiculo_id], references: [id])          
    
    @@map("CHOFER")

}

model TRANSPORTE {
    id                      Int                 @id @default(autoincrement())
    vehiculo                String
    tipo                    String
    color                   String
    placa                   String
    ejes                    Float
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    chofer                  CHOFER[]

    @@map("TRANSPORTE")

}

model DOCUMENTOS_SGC {
    id                      Int                 @id @default(autoincrement())
    tipo                    String
    archivo                 String
    nombre                  String
    titulo                  String
    descripcion             String?
    archivoUrl              String    
    extension               String?    
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())
    usuario_id              Int?

    usuario       USUARIOS? @relation(fields: [usuario_id], references: [id])

    @@map("DOCUMENTOS_SGC")
}

model MUESTREOS {
    id                      Int                 @id @default(autoincrement())
    fecha                   DateTime
    proveedor_id            Int
    huertero                String?
    lote                    String
    ciudad                  String
    estado                  String
    ton_aprox               Float?
    bta                     Float
    acidez                  Float
    rto                     Float
    rendimiento             Float
    sabor                   String
    color                   String
    aceite                  Float?
    observaciones           String?
    analizo                 String
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @default(now())

    registro            DETALLES_REGISTRO_DESCARGA_FRUTA_PARA_PROCESO[]   

    @@map("MUESTREOS")
}

// Datos que deben estar en las tablas

enum ROLES_GENERALES {
    SUPER_ADMIN
    USUARIO
    ADMIN
    GERENTE
    SUPERVISOR
}

enum GENEROS {
    MASCULINO
    FEMENINO
    OTROS
}

enum ESTADOS_DE_PROCESO {
    CARGA
    DESCARGA
    EXTRACCION
    HOMOGENEANIZACION
    REFRIGERACION
    EMPAQUE
    ENVIADO
    RECIBIDO
    ACEPTADO
    PENDIENTE
    COMPLETADO
    CANCELADO
    RECHAZADO
}

enum AREAS_GENERALES {
    PROCESO
    ADMINISTRATIVO
    CALIDAD
    REFRIGERACION
    MANTENIMIENTO
    ALMACEN
    LIMPIEZA
    TRANSPORTE
}

enum AREAS_DE_PROCESO {
    DESCARGA
    SELECCION_Y_LAVADO
    EXTRACCION_JUGO
    EXTRACCION_PULPA
    EXTRACCION_ACEITE
    HOMOGENEANIZACION
    ENVASADO
    CASCARILLA
    PATIO
    CLORIZACION_AGUA
}

enum AREAS_DE_CALIDAD {
    LABORATORIO
}

enum AREAS_ADMINISTRATIVAS {
    FINANZAS
    SISTEMAS_CALIDAD
    ASEGURACION_CALIDAD
    RECURSOS_HUMANOS
    VENTAS
    COMPRAS
}

enum AREAS_ALMACEN {
    MATERIAL_EMPAQUE
    PRODUCTOS_QUIMICOS
    PRODUCTOS_TERMINADOS
    REFACCIONES
}